# 设计文档：平台 API 集成

## 概述

本设计文档描述了如何将当前基于模拟实现的平台适配器升级为真实平台 API 对接。系统将保持现有的架构模式，通过扩展 `BaseAdapter` 类和各平台适配器来实现真实 API 调用，同时保持向后兼容性，支持模拟模式和真实模式的平滑切换。

核心设计目标：
- 最小化对现有代码的侵入性修改
- 提供统一的错误处理和重试机制
- 支持平台特定的功能（验证码处理、内容合规检查）
- 提供完善的可观测性（日志、指标、告警）

## 架构

### 整体架构

系统采用分层架构，从上到下分为：

1. **调度层（Scheduler）**：负责定时任务的触发和执行
2. **服务层（MatrixService）**：负责业务逻辑和数据持久化
3. **适配器层（Platform Adapters）**：负责与各平台 API 交互
4. **工具层（Utils）**：提供通用功能（签名、验证、合规检查）

```
┌─────────────────────────────────────────┐
│         Scheduler (定时任务)             │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─────────────────────────────────────────┐
│      MatrixService (业务逻辑)           │
│  - runDueTasks()                        │
│  - recordPublishMetric()                │
│  - sendAlert()                          │
└──────────────┬──────────────────────────┘
               │
               ▼
┌─