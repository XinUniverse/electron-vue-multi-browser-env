# Electron + Vue 多平台账号矩阵与隔离浏览器需求文档（完善版）

## 1. 文档目标

本文档用于明确产品范围、用户场景、功能需求、非功能需求、技术约束与验收标准，指导基于 **Electron + Vue** 的桌面应用迭代开发。

核心目标：
- 提供“**一个标签页 = 一个全新浏览器环境**”的隔离能力。
- 提供“**多平台账号矩阵管理**”能力，优先支持 **抖音 / 小红书 / 头条**。
- 提供“**热点采集 → AI生成内容 → 定时自动发布**”的可执行工作流。

---

## 2. 术语定义

- **隔离浏览器环境**：每个标签页使用独立的 Electron `partition`（如 `persist:ctx-xxx`），其 Cookie、LocalStorage、SessionStorage、Cache 互相隔离。
- **账号矩阵**：同一运营主体在多平台上的多个账号集合，用于统一管理内容生产与分发。
- **热点**：平台上可用于选题创作的高热度主题/关键词/事件。
- **内容资产**：由 AI 生成的文章、视频脚本、图片文案等可发布素材。
- **发布任务**：与目标账号、发布时间、内容类型关联的自动执行任务。

---

## 3. 产品范围（Scope）

### 3.1 本期范围（In Scope）

1. 隔离标签页管理：新建、切换、关闭、地址栏输入并访问 URL。
2. 账号矩阵基础能力：新增账号、账号列表查看。
3. 热点能力：触发采集、查看热点列表。
4. AI 内容生成：基于热点生成文章/视频脚本/图片文案。
5. 自动发送能力：创建定时发布任务、查看任务状态（基础状态）。
6. 桌面端基础安全：开启 `contextIsolation`、关闭 `nodeIntegration`、启用 `sandbox`。

### 3.2 非本期范围（Out of Scope）

1. 各平台真实发布 API 的全量对接（本期可先以接口抽象/模拟实现）。
2. 复杂审核流（多级审批、协同编辑、版本回滚）。
3. 完整 BI 报表与收益归因分析。
4. 云端多租户权限体系（本期可先单机单用户）。

---

## 4. 目标用户与典型场景

### 4.1 用户角色

1. **内容运营**：负责选题、账号日常发布、热点追踪。
2. **矩阵负责人**：负责多平台统一调度与策略制定。
3. **自动化运营人员**：负责 AI 策略、定时任务与效果优化。

### 4.2 关键使用场景

1. 运营同时打开多个平台后台，互不串号，避免 cookie 冲突。
2. 根据平台热点快速生成多种体裁内容并复用。
3. 为不同账号配置不同发布时间，实现批量定时发布。

---

## 5. 功能需求（FR）

## FR-1 隔离标签页浏览器

### FR-1.1 标签页管理
- 支持“+”新建标签页。
- 支持点击标签切换。
- 支持关闭标签，关闭当前标签后自动切到其他可用标签。

### FR-1.2 完全隔离要求
- 每个标签页必须绑定唯一 `partition`。
- 标签之间不得共享 Cookie / LocalStorage / Cache。
- 关闭标签后释放对应浏览上下文资源。

### FR-1.3 地址栏导航
- 支持输入 URL 并回车访问。
- 若用户输入无协议头地址（如 `openai.com`），自动补全为 `https://`。

---

## FR-2 多平台账号矩阵管理

### FR-2.1 平台支持
- 首批内置平台：**抖音、小红书、头条**。
- 平台列表采用可扩展配置结构，便于后续增加平台。

### FR-2.2 账号管理
- 支持新增账号：平台、账号昵称、AI开关、状态。
- 支持展示账号列表与数量统计。
- 支持账号状态标记（active / disabled）。

---

## FR-3 热点采集

### FR-3.1 热点采集入口
- 提供“收集热点”触发按钮。
- 采集结果至少包含：平台、主题、热度值、采集时间。

### FR-3.2 热点数据展示
- 支持列表选择某条热点用于后续 AI 生成。
- 热点与平台必须可追溯（用于生成提示词上下文）。

---

## FR-4 AI 内容生成

### FR-4.1 生成输入
- 必选：热点。
- 可选：内容类型（文章 / 视频脚本 / 图片文案）、语气风格（专业/活泼等）。

### FR-4.2 生成输出
- 至少输出：标题、正文/脚本文本、生成时间。
- 输出内容可在界面预览。

### FR-4.3 可扩展性
- AI 供应商与模型参数通过统一服务层抽象（后续可接 OpenAI/本地模型）。

---

## FR-5 自动发送与定时发布

### FR-5.1 任务创建
- 可选择目标账号。
- 可选择内容类型。
- 可设置发布时间（datetime）。

### FR-5.2 任务状态
- 至少支持：`scheduled`、`running`、`success`、`failed`。
- 任务列表支持查看数量与基础信息。

### FR-5.3 发布执行（阶段性）
- 本期允许模拟发布执行器。
- 下期替换为平台真实 API 适配层。

---

## 6. 非功能需求（NFR）

### NFR-1 安全性
- Electron 必须启用 `contextIsolation: true`。
- 禁用 `nodeIntegration`。
- 启用 `sandbox`。
- Renderer 与 Main 通信必须走 preload 白名单 API。

### NFR-2 性能
- 标签切换可感知延时建议 < 300ms（本地正常网络）。
- 单机并发打开 10 个标签页时应用不崩溃。

### NFR-3 稳定性
- 异常 URL、无效热点 ID、无效账号 ID 应返回可读错误信息，不得导致主进程崩溃。

### NFR-4 可维护性
- IPC 通道采用命名空间（如 `contexts:*`、`matrix:*`）。
- 业务模块解耦：浏览器上下文模块、矩阵模块、调度模块。

---

## 7. 系统设计建议

## 7.1 模块划分

1. **Main Process**
   - `context-manager`：隔离标签生命周期。
   - `matrix-service`：账号、热点、内容、任务逻辑。
   - `scheduler`：定时任务触发器。

2. **Preload Bridge**
   - `window.isolatedBrowser`
   - `window.accountMatrix`

3. **Renderer (Vue)**
   - 标签栏 + 地址栏。
   - 矩阵工作台（账号、热点、生成、发布）。

## 7.2 数据模型（建议）

- `Account`: id, platform, nickname, aiEnabled, status, createdAt
- `Hotspot`: id, platform, topic, heat, collectedAt
- `ContentAsset`: id, hotspotId, type, tone, title, body, createdAt
- `ScheduleTask`: id, accountId, contentType, publishAt, status, createdAt

---

## 8. 交互与界面要求

1. 顶部为标签栏，可快速新建/切换/关闭。
2. 次顶部为地址栏，支持输入并访问。
3. 中部为“矩阵管理模板”三列：
   - 添加账号
   - 热点采集 + AI 生成
   - 自动发送（定时）
4. 下方或右侧区域显示 AI 生成结果预览。
5. 明确展示当前标签的 `partition`，用于隔离状态可视化。

---

## 9. 验收标准（UAT）

1. 新建两个标签页并分别登录不同测试账号，不出现串号现象。
2. 可成功添加抖音/小红书/头条账号记录。
3. 点击“收集热点”后能得到可选热点列表。
4. 选择热点后可生成至少一种内容并展示。
5. 能创建定时发布任务并在任务列表看到状态。
6. 输入 `openai.com` 能自动补全并成功导航（网络可达时）。

---

## 10. 里程碑建议

- **M1（当前）**：单机模板版（模拟热点、模拟发布、AI占位）。
- **M2**：接入真实 AI 服务与提示词模板管理。
- **M3**：接入平台发布 API 与失败重试机制。
- **M4**：任务监控、日志中心、统计看板。

---

## 11. 风险与待确认事项

1. 各平台开放能力和发布 API 政策差异较大，需要逐平台评估。
2. 自动发布可能涉及风控/验证码/二次校验，需预留人工接管机制。
3. AI 生成内容合规审核策略（敏感词、版权、事实核验）需补充。
4. 若后续多用户协作，需引入账号权限模型与服务端存储。

---

## 12. 后续可执行任务清单（开发拆解）

1. 抽离 `matrix-service` 到独立文件并补充单元测试。
2. 为 IPC 入参增加 schema 校验（如 zod/yup）。
3. 用本地数据库（SQLite）替代内存存储。
4. 接入可配置 AI Provider，并增加重试、超时与费用监控。
5. 增加调度器守护与任务执行日志。

